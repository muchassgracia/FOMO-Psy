<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.487">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="We do the first step of TCM of our chosen theory: Identify relevant phenomena">

<title>FOMO-Psy: Formal Modeling of Psychological Theories - Session 8 - Step 1 in TCM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">FOMO-Psy: Formal Modeling of Psychological Theories</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../sessions/sessions_overview.html"> 
<span class="menu-text">Sessions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../lectures/lecture_overview.html"> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../skills/skills_overview.html"> 
<span class="menu-text">Skills</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/workshop_overview.html"> 
<span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tools.html"> 
<span class="menu-text">Thinking Tools</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../orga_material/orga_material.html"> 
<span class="menu-text">Organizational Material</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#tcm-steps" id="toc-tcm-steps" class="nav-link" data-scroll-target="#tcm-steps">TCM steps</a></li>
  <li><a href="#possible-approaches" id="toc-possible-approaches" class="nav-link" data-scroll-target="#possible-approaches">Possible approaches</a>
  <ul class="collapse">
  <li><a href="#decisions-we-made-together-with-the-expert-researcher" id="toc-decisions-we-made-together-with-the-expert-researcher" class="nav-link" data-scroll-target="#decisions-we-made-together-with-the-expert-researcher">Decisions we made together with the expert researcher:</a></li>
  </ul></li>
  <li><a href="#practical-first-steps" id="toc-practical-first-steps" class="nav-link" data-scroll-target="#practical-first-steps">Practical first steps:</a></li>
  <li><a href="#tcm-step-1-identify-definitions-of-constructs-and-relevant-phenomena" id="toc-tcm-step-1-identify-definitions-of-constructs-and-relevant-phenomena" class="nav-link" data-scroll-target="#tcm-step-1-identify-definitions-of-constructs-and-relevant-phenomena">TCM Step 1: Identify definitions of constructs and relevant phenomena</a>
  <ul class="collapse">
  <li><a href="#concrete-steps" id="toc-concrete-steps" class="nav-link" data-scroll-target="#concrete-steps">Concrete steps</a>
  <ul class="collapse">
  <li><a href="#definitions" id="toc-definitions" class="nav-link" data-scroll-target="#definitions">1. Definitions</a></li>
  <li><a href="#robust-phenomena" id="toc-robust-phenomena" class="nav-link" data-scroll-target="#robust-phenomena">2. Robust Phenomena</a></li>
  </ul></li>
  <li><a href="#how-to-assess-strength-of-evidence" id="toc-how-to-assess-strength-of-evidence" class="nav-link" data-scroll-target="#how-to-assess-strength-of-evidence">How to assess “strength of evidence”</a></li>
  <li><a href="#how-to-assess-generalizability" id="toc-how-to-assess-generalizability" class="nav-link" data-scroll-target="#how-to-assess-generalizability">How to assess “generalizability”</a>
  <ul class="collapse">
  <li><a href="#applying-the-heuristic-to-manylabs2" id="toc-applying-the-heuristic-to-manylabs2" class="nav-link" data-scroll-target="#applying-the-heuristic-to-manylabs2">Applying the heuristic to ManyLabs2</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Session 8 - Step 1 in TCM</h1>
</div>

<div>
  <div class="description">
    We do the first step of TCM of our chosen theory: Identify relevant phenomena
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<table class="table-striped table">
<caption></caption>
<thead>
<tr class="header">
<th>Topic</th>
<th>Duration</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Workshop</strong>: Work on step 1</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>[Homework]</strong>: Finalize step 1</td>
<td>-</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="tcm-steps" class="level1">
<h1>TCM steps</h1>
<ol type="1">
<li><strong>TODAY: Identify definitions of constructs and relevant phenomena</strong></li>
<li>Formulate a prototheory: Create a VAST display</li>
<li>Develop a formal model:
<ul>
<li>Develop a Bischof control system display?</li>
<li>Implement in a programming language?</li>
</ul></li>
<li>Check the adequacy of the formal model
<ul>
<li>Do sensitivity analyses etc.</li>
</ul></li>
<li>Evaluate the overall worth of the constructed theory</li>
</ol>
</section>
<section id="possible-approaches" class="level1">
<h1>Possible approaches</h1>
<p>Formalization approaches can differ in their <em>starting point</em> (which often are not clear-cut distinct):</p>
<ul>
<li>(A.) <strong>Start with the verbal theory</strong>, formalize it as it is.
<ul>
<li>Interpret the verbal statements, make them more precise, visualize as a VAST display</li>
<li>Ignore empirical evidence (even if a hypothesized effect has already been empirically rejected, keep it in the model)</li>
<li>Do not fix inconsistencies, do not improve the theory: We want to make explicit what the original had in mind with their theory.</li>
</ul></li>
<li>(B1.) <strong>TCM approach: Start with robust phenomena</strong>, invent an explanatory theory and formal model
<ul>
<li>Ignore existing verbal theories (which might be hard once you know them)</li>
<li>This will (potentially) lead to an alternative theory/model to the existing theory</li>
</ul></li>
<li>(B2.) <strong>Demiurg approach: Start with an adaptive problem</strong>, construct an organism that is able to solve the problem
<ul>
<li>Potential (draft) formulation of an adaptive problem: “For social mammals, contact to other groups is both a source of opportunities (genetical diversity for mating, knowledge exchange, exploitation) and risks (getting exploited / killed, …). Organisms need to decide when to get in intergroup contact.”</li>
<li>The design of the organism should be based on prior knowledge of capabilities and limitations of organisms</li>
<li>The adaptive problem often implicitly is informed by evidence and phenomena: We know that organisms are capable of solving that in some way.</li>
</ul></li>
<li>(A-B.) <strong>A-B fusion</strong>: Starting point is the narrative theory, but you limit your formalization to those aspects which are (a) theoretically central OR (b) relate to robust phenomena.</li>
</ul>
<section id="decisions-we-made-together-with-the-expert-researcher" class="level2">
<h2 class="anchored" data-anchor-id="decisions-we-made-together-with-the-expert-researcher">Decisions we made together with the expert researcher:</h2>
<p>For limiting the scope of the formalization exercise, we decided to focus on these variables:</p>
<ul>
<li>“Valence of imagination” as moderating variable: This is theoretically important, but there is conflicting empirical evidence (the valence doesn’t seem to make a difference; see meta-analysis of <a href="https://journals.sagepub.com/doi/abs/10.1177/1368430213510573">Miles &amp; Crisp, 2014</a>)</li>
<li>Affective processes as mediating variable
<ul>
<li>Erst die Prozessvariablen machen aus der Hypothese eine Erklärung. Aber die Erklärung ist recht unterspezifiziert: was genau heißt “die Einstellung ändert sich”. Was genau? Die Valenz? Der Inhalt? die gefühlte Distanz zur outgroup Eine Möglichkeit: Ängste reduzieren.</li>
</ul></li>
<li>Primary outcomes:
<ul>
<li>“Im Kern der ursprünglichen Hypothese liegt die outgroup perception (welche ein Oberbegriff von”Einstellung” und/oder die “Vorurteile” ist (Einstellungen werden als Proxy für Vorurteile genommen)”</li>
<li>“Einstellung” als weiteres Konstrukt aufnehmen (vor der approach tendency)? Zu komplex/schwammig? Wie ist dieses Konstrukt im Kontext <em>dieser</em> Theorie definiert? –&gt; wenn dann irgendwie konkretisieren</li>
<li>Einstellung hat drei Komponenten: kognitiv, affektiv, beharioval tendency</li>
<li>(Self-reported) approach tendencies
<ul>
<li>We do not model actual behavior, as this is too multi-determined. Hence, everything happens “within the mind” of the actors.</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="practical-first-steps" class="level1">
<h1>Practical first steps:</h1>
<ul>
<li>Work as one or two groups?
<ul>
<li>Collect definitions and relevant phenomena in the entire group (so that all have the same foundation)</li>
<li>Strive for one common model</li>
<li>Assign subtasks to subgroups, results are discussed and get merged (as a consensus) into the joint model</li>
<li>Faster if one group</li>
</ul></li>
<li>Create a new Github repository. Initialize with a README; create a <code>dev</code> branch, start working there.</li>
<li>Google doc with “how to”: Collect all practical tipps and decisions that helped you to accomplish this task</li>
<li>Enter your notes (during the working session) into collaborative markdown documents (e.g., on HedgeDoc). At the end of the working session, add/update the markdown doc in the Github repo.</li>
</ul>
</section>
<section id="tcm-step-1-identify-definitions-of-constructs-and-relevant-phenomena" class="level1">
<h1>TCM Step 1: Identify definitions of constructs and relevant phenomena</h1>
<p>Two goals:</p>
<ol type="1">
<li>Decide upon a working <strong>definition</strong> for your focal constructs.</li>
<li>Identify and define empirically <strong>robust phenomena</strong> related to your constructs.</li>
</ol>
<section id="concrete-steps" class="level2">
<h2 class="anchored" data-anchor-id="concrete-steps">Concrete steps</h2>
<section id="definitions" class="level3">
<h3 class="anchored" data-anchor-id="definitions">1. Definitions</h3>
<p>Use the primary literature to define the focal constructs:</p>
<ol type="1">
<li>Search for definitions, collect them in a document (remembeto provide precise references, with page number).</li>
<li>Compare different definitions (maybe in a table?)</li>
<li>(optional) If no single existing definition is sufficient, agree on a consensus working definition for the context of our project.</li>
<li><strong>Deliverable 1</strong>: Write a paragraph/section/table that collects the final definitions. Clearly cite and quote existing definitions. Make clear when you deviate from an existing definition and give a justification why.</li>
<li><strong>Deliverable 2</strong>: Create a first VAST display with constructs and naming relationships (use either verbal quotes or your consensus definition)</li>
</ol>
</section>
<section id="robust-phenomena" class="level3">
<h3 class="anchored" data-anchor-id="robust-phenomena">2. Robust Phenomena</h3>
<p>Phenoma describe relations between our focal constructs.</p>
<p>Robustness of phenomena has two dimensions:</p>
<ul>
<li>strong empirical evidence</li>
<li>generalizable (cf.&nbsp;<a href="../lectures/Intro1/FOMO-Psy_1_Data_phenomena.html#the-relation-of-data-and-phenomena-2">UTOS framework</a>): The effect has been shown for different <span class="hl">Units</span>, with different operationalizations of <span class="hl">Treatments</span> and <span class="hl">Outcomes</span>, and in multiple <span class="hl">Settings</span></li>
</ul>
<ol type="1">
<li>Search for meta-analyses that report on phenomena with our focal variables</li>
<li>Only if no meta-analysis is available, or it is not helpful: Do a broader literature search on the level of primary studies.</li>
<li>Assess the robustness of the phenomena along the two dimensions:
<ol type="1">
<li>How <em>strong</em> is the evidence? (e.g., based on number <em>k</em> of studies in a meta-analysis, strength of evidence, risk of bias)</li>
<li>How <em>generalizable</em> is it? Go through all four UTOS dimensions and evaluate which types of generalization have been shown across studies.</li>
</ol></li>
<li><strong>Deliverable 3</strong>: Write a paragraph/section that makes an overall assessment of the robustness of each phenomenon and gives a clear and explicit answer: “The phenomenon can (not) be considered robust because, …”. Refer to the two dimensions of robustness and point towards references that back up your claim with evidence.</li>
</ol>
</section>
</section>
<section id="how-to-assess-strength-of-evidence" class="level2">
<h2 class="anchored" data-anchor-id="how-to-assess-strength-of-evidence">How to assess “strength of evidence”</h2>
<p>TODO</p>
</section>
<section id="how-to-assess-generalizability" class="level2">
<h2 class="anchored" data-anchor-id="how-to-assess-generalizability">How to assess “generalizability”</h2>
<p>When you assess the generalizability, you should distinguish <strong>three prototypical epistemic states</strong>:</p>
<ul>
<li>“I know that it is generalizable.”</li>
<li>“I know that it is not generalizable.”</li>
<li>“I do not know whether it is generalizable or not - with the given empirical evidence I cannot answer this question.”</li>
</ul>
<p>As the strength of evidence can be continuous, the situation can be visualizes on a graph (see Figure 1):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../common/Generalizability_space.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1: Possible results of a generalizability assessment.</figcaption>
</figure>
</div>
<p>We describe six prototypical examples:</p>
<ul>
<li><strong>(A)</strong>: Many variations have been tested and led to very different results, maybe even with a sign flip. This is strong evidence that the phenomenon <strong>is not</strong> generalizable.</li>
<li><strong>(B)</strong>: Many variations have been tested and all led to comparable results. This is strong evidence that the phenomenon <strong>is</strong> generalizable - at least within the space of sampled variations.</li>
<li><strong>(C)</strong>: Few variations have been tested and led to quite different results. This is weak evidence that the phenomenon <strong>is not</strong> generalizable.</li>
<li><strong>(D)</strong>: Few variations have been tested and all led to comparable results. This is weak evidence that the phenomenon <strong>is</strong> generalizable.</li>
<li><strong>(E)</strong>: Only one variation has been tested. It is principally unknowable whether the result generalizes to other variations; the evidence is totally inconclusive. We can only conclude that we cannot conclude anything about generalizability. This also implies, that the question of generalizability cannot be answered if only a single (or very few) studies are available, or if the existing studies have no variation in the respective UTOS dimensions.</li>
</ul>
<p>The dashed line symbolizes the space of possible combinations: With very small samples, it is very unliekly (or even impossible) to generate strong evidence in either direction.</p>
<p>An open question of course is, how close results should be to speak of high generalizability? Do the results in the right half of the plot have to be nearly identical? How much heterogeneity is allowed?</p>
<section id="applying-the-heuristic-to-manylabs2" class="level3">
<h3 class="anchored" data-anchor-id="applying-the-heuristic-to-manylabs2">Applying the heuristic to ManyLabs2</h3>
<p>All four UTOS dimensions can get an independent assessment. Consider the <a href="https://journals.sagepub.com/doi/10.1177/2515245918810225">ManyLabs2 study</a>: The identical experiment (except translation of materials) has been administered online in very diverse samples (at least diverse with respect to nationality and cultural background). Hence, there was high variation in the U(nits) and the S(ettings) dimensions, but very low variation in the T(reatment) and O(utcome) dimension. Non-zero effects were found with remarkably low variability across samples: “Cumulatively, variability in the observed effect sizes was attributable more to the effect being studied than to the sample or setting in which it was studied” (quoted from the Abstract).</p>
<p>Hence, a stylized analysis of the ML2 study could look like:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../common/Generalizability_space_ML2.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2: A generalizability assessment of the UTOS dimensions in ManyLabs 2.</figcaption>
</figure>
</div>
<p>Hence, we have strong evidence for high generalizability for the U and the S dimension, but we cannot make a conclusion concerning the T and the O dimensions, as they lacked the necessary variation in the study.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>